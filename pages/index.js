import Head from 'next/head'
import Image from 'next/image'
import styles from '../styles/Home.module.css'
import { useState, useEffect } from 'react';

export async function getStaticProps() {
  const matchDate = '2022-07-14';
    
  const options = {
    method: 'GET',
    url: 'https://api-football-v1.p.rapidapi.com/v3/fixtures',
    params: { date: matchDate },
    headers: {
      'X-RapidAPI-Key': process.env.API_FOOTBALL_KEY,
      'X-RapidAPI-Host': 'api-football-v1.p.rapidapi.com',
    },
  };

  return { 
    props: {
      options,
    },
  }
}

export default function Home( { options } ) {
  const axios = require('axios');
  const matchDate = '2022-07-14';
  
  const [loadingData, setLoadingData] = useState(true);
  const [footballData, setFootballData] = useState([]);

  useEffect(() => {
    async function getData() {
      await axios
        .request(options)
        // eslint-disable-next-line func-names
        .then(function(response) {
          console.log(response.data.response);

          // after fetching data store it in posts state
          setFootballData(response.data.response);

          // loading is done
          setLoadingData(false);
        })
        // eslint-disable-next-line func-names
        .catch(function(axiosError) {
          console.error(axiosError);
        });
    }
    if (loadingData) {
      // if the result is not ready so you make the axios call
      getData();
    }
  }, []);


  return (
    <div className={styles.container}>
      <Head>
        <title>Football Advisor</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main className={styles.main}>
        <h1 className={styles.title}>
          Welcome to Football Advisor
        </h1>

        <div className={styles.grid}>
        <h1 className={styles.fixture}>{matchDate}</h1>
          {loadingData ? (
            <p>Loading data...</p>
          ) : (
            footballData.map(myItem => (
              // eslint-disable-next-line react/jsx-key
              <div className={styles.fixture}>
                <h2>
                  <Image 
                    src={myItem.teams.home.logo}
                    layout="fixed"
                    height="100"
                    width="100"
                    alt='Home team logo'/>{' '}
                  {myItem.teams.home.name} {myItem.score.fulltime.home} x{' '}
                  {myItem.score.fulltime.away} {myItem.teams.away.name}{' '}
                  <Image 
                    src={myItem.teams.away.logo}
                    layout="fixed"
                    height="100"
                    width="100"
                    alt='away team logo'/>
                </h2>
                <h3>
                  {myItem.fixture.venue.name} ({myItem.fixture.venue.city})
                </h3>
                <h4>
                  {myItem.league.name} ({myItem.league.country}) -{' '}
                  {myItem.league.round}{' '}
                </h4>
                <div>
                  <Image 
                    src={myItem.league.logo}
                    layout="fixed"
                    height="50"
                    width="50"
                    alt='league logo'/>
                </div>
              </div>
            ))
          )}
        </div>
      </main>

      <footer className={styles.footer}>
        <a
          href="https://vercel.com?utm_source=create-next-app&utm_medium=default-template&utm_campaign=create-next-app"
          target="_blank"
          rel="noopener noreferrer"
        >
          Powered by{' '}
          <span className={styles.logo}>
            <Image src="/vercel.svg" alt="Vercel Logo" width={72} height={16} />
          </span>
        </a>
      </footer>
    </div>
  )
}
